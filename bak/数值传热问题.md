# 数值传热问题

# 算法框架

**以下所称的边界点均为实际存在的控制点，而非虚控制点**

##  输入

考虑三种输入情况

- 所有边界控制点均为第一类边界条件
- 所有边界控制点均为第二类边界条件
- 边界点随机第一类或者第二类边界条件

如何存储边界条件数据

- 存储为8个vec放在一个hdf5文件中，4个size=n的u的vec，4个size=n的h的vec，默认边界u,h条件不随时间变化
- 存储初始温度为$n^2$的vec

如何判断该边界点为哪种边界条件？

- 计算算该边界点对应的系数矩阵元素时，考察他们的（是否为0是否不为0是否同时为0是否同时不为0）值然后来计算，系数矩阵规模为$n^2$

## 计算

- 设置时间步长为$\Delta t$，空间步长长宽相等为$\Delta x=\Delta y=\Delta l$

- 计算系数矩阵，为稀疏矩阵，最多有5个对角线有值

  - 系数矩阵$A$

  - 对于内部点，系数矩阵对应行有5个值，分别关联本身和周围4个点

    

    

  - 对于边界点第一类边界，计算时注意$\delta$只按一半算，对应行也有5个值

  - 对于边界点第二类边界，计算时只有3个或者4个值，分别关联本身和周围的2个或3个点，热流放右向量b中

- 根据隐式还是显式计算矩阵向量方程的右向量，跟据二维平面每一点的情况来计算（这里是显式，隐式还未验证）

  - $b=f\Delta l\Delta l +h_e+h_w+h_n+h_s$
  - 对于内部点只有$f\Delta l\Delta l $
  - 对于边界点，紧挨哪个边界就加哪个$h$

- 迭代计算

  - 对于显式现在我们有系数矩阵$A$，$T_0$时刻的已知温度 $u_0$ ，可以根据$u_1=Au_0+b$ 来计算 $T_1$ 时刻的温度
  - 对于隐式现在我们有系数矩阵$A$，$T_0$时刻的已知温度 $u_0$ ，可以求解$Au_1=u0+b$ 来计算 $T_1$ 时刻的温度



## 数学推导

**在边界处，计算系数时，$\delta$ 是内部值的一半**

### 显式一维问题

![image-20220603093307116](https://perhaps-1306015279.cos.ap-guangzhou.myqcloud.com/image-20220603093307116.png)
$$
\rho c (T_p^1-T_p^0)\Delta x = k(\frac{T_E^0-T_P^0}{\delta x_e}-\frac{T_P^0-T_W^0}{\delta x_w})\Delta t +f\Delta x \Delta t
$$

$$
a_P^1T_P^1=a_E^0T_E^0+a_W^0T_W^0+a_P^0T_P^0+f\Delta x
$$

$$
a_P^1=\frac{\rho c \Delta x}{\Delta t} \\
a_E^0=\frac{k}{\delta x_w} \\
a_W^0=\frac{k}{\delta x_e} \\
a_P^0=\frac{\rho c \Delta x}{\Delta t}-\frac{k}{\delta x_e}-\frac{k}{\delta x_w}\\
We \ have:\ a_p^1=a_E^0+a_W^0+a_P^0
$$

## 显式二维问题

![image-20220603094116994](https://perhaps-1306015279.cos.ap-guangzhou.myqcloud.com/image-20220603094116994.png)
$$
\rho c \Delta x \Delta y(T_p^1-T_p^0) = k(\frac{T_E^0-T_P^0}{\delta x_e}-\frac{T_P^0-T_W^0}{\delta x_w})\Delta y \Delta t +k(\frac{T_N^0-T_P^0}{\delta y_n}-\frac{T_P^0-T_S^0}{\delta y_s})\Delta x \Delta t+f\Delta x \Delta y \Delta t
$$

$$
a_P^1T_P^1=a_E^0T_E^0+a_W^0T_W^0+a_N^0T_N^0+a_S^0T_S^0+a_P^0T_P^0+b\\
b=f\Delta x\Delta y
$$

$$
a_P^1=\frac{\rho c \Delta x\Delta y}{\Delta t} \\
a_E^0=\frac{k\Delta y}{\delta x_w} \\
a_W^0=\frac{k\Delta y}{\delta x_e} \\
a_N^0=\frac{k\Delta x}{\delta y_n} \\
a_S^0=\frac{k\Delta x}{\delta y_s} \\
a_P^0=\frac{\rho c \Delta x\Delta y}{\Delta t}-\frac{k\Delta y}{\delta x_w}-\frac{k\Delta y}{\delta x_e}-\frac{k\Delta x}{\delta y_n}-\frac{k\Delta x}{\delta y_s}\\
We \ have:\ a_p^1=a_E^0+a_W^0+a_N^0+a_S^0+a_P^0
$$

## 隐式二维问题

$$
\rho c \Delta x \Delta y(T_p^1-T_p^0) = k(\frac{T_E^1-T_P^1}{\delta x_e}-\frac{T_P^1-T_W^1}{\delta x_w})\Delta y \Delta t +k(\frac{T_N^1-T_P^1}{\delta y_n}-\frac{T_P^1-T_S^1}{\delta y_s})\Delta x \Delta t+f\Delta x \Delta y \Delta t
$$

$$
a_P^1T_P^1=a_E^1T_E^1+a_W^1T_W^1+a_N^1T_N^1+a_S^1T_S^1+a_P^0T_P^0+b\\
b=f\Delta x\Delta y
$$

$$
a_E^1=\frac{k\Delta y}{\delta x_w} \\
a_W^1=\frac{k\Delta y}{\delta x_e} \\
a_N^1=\frac{k\Delta x}{\delta y_n} \\
a_S^1=\frac{k\Delta x}{\delta y_s} \\
a_P^0=\frac{\rho c \Delta x\Delta y}{\Delta t} \\
a_P^1=\frac{\rho c \Delta x\Delta y}{\Delta t}+\frac{k\Delta y}{\delta x_w}+\frac{k\Delta y}{\delta x_e}+\frac{k\Delta x}{\delta y_n}+\frac{k\Delta x}{\delta y_s}\\
We \ have:\ a_p^1=a_E^1+a_W^1+a_N^1+a_S^1+a_P^0
$$

## 第一类边界条件

**边界值给出边界温度，即虚控制体的题温度，根据以上公式即可求解**

**计算系数矩阵时，注意由于边界虚控制体的中心在边界面上，所以 $\delta $ 是内部点的一半**

**计算完边界值，作为热源放入方程中！！！！！**

## 第二类边界条件显式

**对于二维边界的左边界值**
$$
由于\ h=k\frac{\partial u}{\partial x} \\
$$

$$
有\ \rho c \Delta x \Delta y(T_p^1-T_p^0) = (k\frac{T_E^0-T_P^0}{\delta x_e}+h_w)\Delta y \Delta t +k(\frac{T_N^0-T_P^0}{\delta y_n}-\frac{T_P^1-T_S^1}{\delta y_s})\Delta x \Delta t+f\Delta x \Delta y \Delta t
$$

$$
a_P^1T_P^1=a_E^0T_E^0+a_W^0T_W^0+a_N^0T_N^0+a_S^0T_S^0+a_P^0T_P^0+b\\
b=f\Delta x\Delta y+h_w; \ \  \  \ \ \ h_w可以随时间变化，也可以是常量
$$

$$
a_P^1=\frac{\rho c \Delta x\Delta y}{\Delta t} \\
a_E^0=\frac{k\Delta y}{\delta x_w} \\
a_W^0=0 \\
a_N^0=\frac{k\Delta x}{\delta y_n} \\
a_S^0=\frac{k\Delta x}{\delta y_s} \\
a_P^0=\frac{\rho c \Delta x\Delta y}{\Delta t}-\frac{k\Delta y}{\delta x_w}-\frac{k\Delta x}{\delta y_n}-\frac{k\Delta x}{\delta y_s}\\
We \ have:\ a_p^1=a_E^0+a_W^0+a_N^0+a_S^0+a_P^0
$$

**上下左右边界同理**

**对于顶点，若所在的两个边界都是第二类边界，即接受两个热流流入**

**例如 左上角**
$$
有\ \rho c \Delta x \Delta y(T_p^1-T_p^0) = (k\frac{T_E^0-T_P^0}{\delta x_e}+h_w)\Delta y \Delta t +(kh_n-\frac{T_P^1-T_S^1}{\delta y_s})\Delta x \Delta t+f\Delta x \Delta y \Delta t
$$

$$
a_P^1T_P^1=a_E^0T_E^0+a_W^0T_W^0+a_N^0T_N^0+a_S^0T_S^0+a_P^0T_P^0+b\\
b=f\Delta x\Delta y+h_w+h_n; \ \  \  \ \ \ h_w,h_n可以随时间变化，但本项目用常量
$$

$$
a_P^1=\frac{\rho c \Delta x\Delta y}{\Delta t} \\
a_E^0=\frac{k\Delta y}{\delta x_w} \\
a_W^0=0 \\
a_N^0=0 \\
a_S^0=\frac{k\Delta x}{\delta y_s} \\
a_P^0=\frac{\rho c \Delta x\Delta y}{\Delta t}-\frac{k\Delta y}{\delta x_w}-\frac{k\Delta x}{\delta y_s}\\
We \ have:\ a_p^1=a_E^0+a_W^0+a_N^0+a_S^0+a_P^0
$$

## 第二类边界条件隐式

$$
有\ \rho c \Delta x \Delta y(T_p^1-T_p^0) = (k\frac{T_E^1-T_P^1}{\delta x_e}+h_w)\Delta y \Delta t +k(\frac{T_N^1-T_P^1}{\delta y_n}-\frac{T_P^1-T_S^1}{\delta y_s})\Delta x \Delta t+f\Delta x \Delta y \Delta t
$$

$$
a_P^1T_P^1=a_E^1T_E^1+a_W^1T_W^1+a_N^1T_N^1+a_S^1T_S^1+a_P^0T_P^0+b\\
b=f\Delta x\Delta y+h_e+h_w+h_n+h_s (h最多只有两个非零项)
$$


$$
a_E^1=\frac{k\Delta y}{\delta x_w} \\
a_W^1=\frac{k\Delta y}{\delta x_e} \\
a_N^1=\frac{k\Delta x}{\delta y_n} \\
a_S^1=\frac{k\Delta x}{\delta y_s} \\
a_P^0=\frac{\rho c \Delta x\Delta y}{\Delta t} \\
a_P^1=\frac{\rho c \Delta x\Delta y}{\Delta t}+\frac{k\Delta y}{\delta x_w}+\frac{k\Delta y}{\delta x_e}+\frac{k\Delta x}{\delta y_n}+\frac{k\Delta x}{\delta y_s}\\
We \ have:\ a_p^1=a_E^1+a_W^1+a_N^1+a_S^1+a_P^0
$$
